<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HomeBridge - Your AI Health Companion</title>
    <style>
        /* ELDERLY-FIRST CSS DESIGN */
        
        /* Base settings optimized for elderly users */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            font-size: 24px; /* Large base font for elderly */
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Arial', sans-serif; /* Simple, readable font */
            font-size: 24px; /* Minimum 24px as specified */
            line-height: 1.6; /* Better readability */
            letter-spacing: 0.05em; /* Character clarity */
            background-color: #ffffff; /* Pure white background */
            color: #1e293b; /* Dark text for 7:1 contrast ratio */
            overflow-x: hidden;
            padding: 20px;
        }
        
        /* Screen container */
        .screen {
            display: none;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            min-height: 100vh;
            text-align: center;
        }
        
        .screen.active {
            display: block;
        }
        
        /* Emergency contact - always visible */
        .emergency-contact {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #dc2626;
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            border: none;
            z-index: 1000;
        }
        
        .emergency-contact:hover,
        .emergency-contact:focus {
            background: #b91c1c;
            outline: 4px solid #fbbf24;
            transform: scale(1.05);
        }
        
        /* Headers - Extra large for elderly */
        h1 {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #1e293b;
        }
        
        h2 {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 25px;
            color: #1e293b;
        }
        
        /* Large text elements */
        .large-text {
            font-size: 32px;
            margin-bottom: 20px;
            color: #1e293b;
        }
        
        .medium-text {
            font-size: 28px;
            margin-bottom: 15px;
            color: #4b5563;
        }
        
        /* Primary large buttons - minimum 200px width, 100px height */
        .primary-button {
            background: #4f46e5;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 30px 50px;
            font-size: 36px;
            font-weight: bold;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            min-width: 250px;
            min-height: 100px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }
        
        .primary-button:hover,
        .primary-button:focus {
            background: #3730a3;
            outline: 4px solid #fbbf24;
            transform: scale(1.05);
        }
        
        /* Secondary buttons */
        .secondary-button {
            background: #6b7280;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 20px 30px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px;
            min-width: 200px;
            min-height: 80px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .secondary-button:hover,
        .secondary-button:focus {
            background: #4b5563;
            outline: 4px solid #fbbf24;
        }
        
        /* Call button */
        .call-button {
            background: #059669;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 25px 40px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            margin: 20px;
            min-width: 250px;
            min-height: 90px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .call-button:hover,
        .call-button:focus {
            background: #047857;
            outline: 4px solid #fbbf24;
            transform: scale(1.05);
        }
        
        /* Family context section */
        .family-context {
            background: #f8fafc;
            border: 3px solid #e2e8f0;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }
        
        .family-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #d1d5db;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }
        
        /* Logo */
        .logo {
            width: 150px;
            height: 150px;
            margin: 0 auto 30px;
            background: #4f46e5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            font-weight: bold;
        }
        
        /* PIN input styles */
        .pin-display {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }
        
        .pin-dot {
            width: 40px;
            height: 40px;
            border: 3px solid #4b5563;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }
        
        .pin-dot.filled {
            background: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        
        /* Keypad for PIN */
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 300px;
            margin: 40px auto;
        }
        
        .keypad-button {
            width: 80px;
            height: 80px;
            border: 3px solid #4b5563;
            border-radius: 12px;
            background: white;
            font-size: 48px;
            font-weight: bold;
            cursor: pointer;
            color: #1e293b;
        }
        
        .keypad-button:hover,
        .keypad-button:focus {
            background: #f1f5f9;
            outline: 4px solid #fbbf24;
        }
        
        .keypad-button.special {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }
        
        .keypad-button.submit {
            background: #059669;
            color: white;
            border-color: #059669;
        }
        
        /* Voice interface */
        .voice-interface {
            margin: 40px 0;
        }
        
        .microphone-button {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: #4f46e5;
            border: none;
            color: white;
            font-size: 72px;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }
        
        .microphone-button:hover,
        .microphone-button:focus {
            background: #3730a3;
            outline: 6px solid #fbbf24;
            transform: scale(1.05);
        }
        
        .microphone-button.recording {
            background: #dc2626;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Status indicators */
        .status {
            font-size: 28px;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 12px;
        }
        
        .status.listening {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .status.thinking {
            background: #fef3c7;
            color: #d97706;
        }
        
        .status.speaking {
            background: #dcfce7;
            color: #166534;
        }
        
        /* Conversation display */
        .conversation {
            text-align: left;
            max-width: 600px;
            margin: 30px auto;
        }
        
        .message {
            margin: 20px 0;
            padding: 20px;
            border-radius: 16px;
            font-size: 24px;
            line-height: 1.5;
        }
        
        .message.ai {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            margin-right: 60px;
        }
        
        .message.user {
            background: #f3f4f6;
            border: 2px solid #6b7280;
            margin-left: 60px;
            text-align: right;
        }
        
        /* Tutorial cards */
        .tutorial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }
        
        .tutorial-card {
            background: white;
            border: 3px solid #e5e7eb;
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .tutorial-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        .tutorial-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .tutorial-text {
            font-size: 24px;
            color: #4b5563;
        }
        
        /* Success checkmark */
        .success-icon {
            font-size: 100px;
            color: #059669;
            margin: 30px 0;
        }
        
        /* Audio level indicator */
        .audio-level {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 20px 0;
        }
        
        .audio-bar {
            width: 10px;
            height: 30px;
            background: #d1d5db;
            border-radius: 5px;
        }
        
        .audio-bar.active {
            background: #4f46e5;
            animation: bounce 0.5s infinite alternate;
        }
        
        @keyframes bounce {
            from { height: 30px; }
            to { height: 50px; }
        }
        
        /* Help options */
        .help-options {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .help-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #1e293b;
        }
        
        /* Progress indicator */
        .progress {
            background: #f1f5f9;
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            font-size: 28px;
            font-weight: bold;
        }
        
        /* Responsive design for mobile */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .screen {
                padding: 20px 10px;
            }
            
            h1 {
                font-size: 40px;
            }
            
            .primary-button {
                min-width: 200px;
                font-size: 28px;
            }
            
            .microphone-button {
                width: 250px;
                height: 250px;
                font-size: 60px;
            }
            
            .tutorial-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            body {
                background: #ffffff;
                color: #000000;
            }
            
            .primary-button {
                border: 4px solid #000000;
            }
            
            .secondary-button {
                border: 3px solid #000000;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Emergency Contact Button - Always Visible -->
    <button class="emergency-contact" onclick="emergencyCall()" aria-label="Emergency call to family member">
        📞 Call Sarah
    </button>

    <!-- SCREEN 1: WELCOME LANDING -->
    <div class="screen active" id="welcome-screen">
        <!-- Logo -->
        <div class="logo" aria-label="HomeBridge Logo">
            HB
        </div>
        
        <!-- Main Greeting -->
        <h1>Hello Margaret!</h1>
        <p class="large-text">Your AI Health Companion</p>
        
        <!-- Family Context -->
        <div class="family-context" role="region" aria-label="Family setup information">
            <div class="family-photo" aria-label="Sarah's photo">👩</div>
            <p class="large-text">Sarah set this up to help keep you healthy and connected</p>
            <p class="medium-text">Just like having a caring nurse check in daily</p>
            <button class="call-button" onclick="callFamily()" aria-label="Call Sarah for help">
                📞 Need help? Call Sarah: 07700-123-456
            </button>
        </div>
        
        <!-- Main Action -->
        <button class="primary-button" onclick="startSetup()" aria-label="Start talking to begin setup">
            🎤 Start Talking
        </button>
        
        <!-- Safety Information -->
        <div class="help-options">
            <p class="large-text">This is completely safe and private</p>
            <p class="medium-text">Your conversations are encrypted and only shared with Sarah</p>
        </div>
        
        <!-- Audio Instructions -->
        <div id="audio-instructions" aria-live="polite"></div>
    </div>

    <!-- SCREEN 2: AUTHENTICATION -->
    <div class="screen" id="auth-screen">
        <h1>Enter your secret code</h1>
        <p class="large-text">Sarah gave you a 4-digit code</p>
        <p class="medium-text">It's the same code they wrote down for you</p>
        
        <!-- PIN Display -->
        <div class="pin-display" role="group" aria-label="PIN entry display">
            <div class="pin-dot" id="pin-1" aria-label="PIN digit 1"></div>
            <div class="pin-dot" id="pin-2" aria-label="PIN digit 2"></div>
            <div class="pin-dot" id="pin-3" aria-label="PIN digit 3"></div>
            <div class="pin-dot" id="pin-4" aria-label="PIN digit 4"></div>
        </div>
        
        <!-- Keypad -->
        <div class="keypad" role="group" aria-label="Number keypad">
            <button class="keypad-button" onclick="addPin('1')" aria-label="1">1</button>
            <button class="keypad-button" onclick="addPin('2')" aria-label="2">2</button>
            <button class="keypad-button" onclick="addPin('3')" aria-label="3">3</button>
            <button class="keypad-button" onclick="addPin('4')" aria-label="4">4</button>
            <button class="keypad-button" onclick="addPin('5')" aria-label="5">5</button>
            <button class="keypad-button" onclick="addPin('6')" aria-label="6">6</button>
            <button class="keypad-button" onclick="addPin('7')" aria-label="7">7</button>
            <button class="keypad-button" onclick="addPin('8')" aria-label="8">8</button>
            <button class="keypad-button" onclick="addPin('9')" aria-label="9">9</button>
            <button class="keypad-button special" onclick="clearPin()" aria-label="Clear PIN">Clear</button>
            <button class="keypad-button" onclick="addPin('0')" aria-label="0">0</button>
            <button class="keypad-button submit" onclick="submitPin()" aria-label="Submit PIN" id="submit-pin" disabled>Submit</button>
        </div>
        
        <!-- Help Options -->
        <div class="help-options">
            <p class="help-title">Need Help?</p>
            <button class="secondary-button" onclick="callFamily()">📞 Call Sarah</button>
            <button class="secondary-button" onclick="forgotCode()">❓ I forgot my code</button>
            <button class="secondary-button" onclick="tryVoice()">🔄 Try voice instead</button>
        </div>
    </div>

    <!-- SCREEN 3: FIRST CONVERSATION -->
    <div class="screen" id="conversation-screen">
        <h1>Let's have our first chat!</h1>
        
        <!-- AI Status -->
        <div class="status listening" id="ai-status" aria-live="polite">
            🤖 HomeBridge is listening...
        </div>
        
        <!-- Conversation Display -->
        <div class="conversation" id="conversation-display" role="log" aria-label="Conversation with HomeBridge">
            <div class="message ai">
                <strong>HomeBridge:</strong> Hello Margaret! I'm HomeBridge, your AI health companion. Sarah asked me to check in with you daily to make sure you're doing well. How are you feeling today?
            </div>
        </div>
        
        <!-- Voice Interface -->
        <div class="voice-interface">
            <button class="microphone-button" id="mic-button" onclick="toggleRecording()" aria-label="Press and hold to speak your answer">
                🎤
            </button>
            <div class="audio-level" id="audio-level" aria-hidden="true">
                <div class="audio-bar"></div>
                <div class="audio-bar"></div>
                <div class="audio-bar"></div>
                <div class="audio-bar"></div>
                <div class="audio-bar"></div>
            </div>
        </div>
        
        <!-- Progress -->
        <div class="progress" aria-live="polite">
            Question 1 of 3 - Almost done!
        </div>
        
        <!-- Alternative Options -->
        <button class="secondary-button" onclick="tryAgain()">🔄 Say that again</button>
        <button class="secondary-button" onclick="needHelp()">❓ I don't understand</button>
        
        <!-- Family Integration Info -->
        <div class="help-options">
            <p class="medium-text">Sarah will see a summary of our chat</p>
            <p class="medium-text">This helps them know you're doing well</p>
            <p class="medium-text">Everything is private and secure</p>
        </div>
    </div>

    <!-- SCREEN 4: SUCCESS & TUTORIAL -->
    <div class="screen" id="success-screen">
        <!-- Celebration -->
        <div class="success-icon" aria-label="Success checkmark">✅</div>
        <h1>Great job! You're all set up!</h1>
        <p class="large-text">Sarah will be so proud!</p>
        
        <!-- Tutorial Cards -->
        <div class="tutorial-grid">
            <div class="tutorial-card">
                <div class="tutorial-icon">🕒</div>
                <div class="tutorial-title">Tomorrow I'll call you at 9:00 AM</div>
                <div class="tutorial-text">Just answer like a normal conversation</div>
            </div>
            
            <div class="tutorial-card">
                <div class="tutorial-icon">💬</div>
                <div class="tutorial-title">Speak naturally, like talking to a friend</div>
                <div class="tutorial-text">I'll ask about your health and mood</div>
            </div>
            
            <div class="tutorial-card">
                <div class="tutorial-icon">👥</div>
                <div class="tutorial-title">Sarah will get health updates weekly</div>
                <div class="tutorial-text">They'll call if anything seems wrong</div>
            </div>
            
            <div class="tutorial-card">
                <div class="tutorial-icon">🆘</div>
                <div class="tutorial-title">Press the red button if you need help</div>
                <div class="tutorial-text">Emergency button - Always available</div>
            </div>
        </div>
        
        <!-- Practice Option -->
        <button class="secondary-button" onclick="practiceAgain()">🔄 Practice again</button>
        
        <!-- Completion -->
        <button class="primary-button" onclick="finishSetup()">✅ I'm ready!</button>
        
        <!-- Family Contact Card -->
        <div class="family-context">
            <div class="family-photo">👩</div>
            <p class="large-text">Sarah Johnson</p>
            <p class="medium-text">Available 8:00 AM - 8:00 PM</p>
            <button class="call-button" onclick="callFamily()">📞 Call Sarah: 07700-123-456</button>
        </div>
    </div>

    <script>
        // ELDERLY-OPTIMIZED JAVASCRIPT
        
        // Global variables
        let currentScreen = 0;
        let pinCode = '';
        let isRecording = false;
        let recognition;
        let currentConversationStep = 0;
        
        // Family information - would be populated from setup
        const familyInfo = {
            name: 'Sarah',
            phone: '07700-123-456',
            relationship: 'daughter'
        };
        
        // Screen management
        const screens = ['welcome-screen', 'auth-screen', 'conversation-screen', 'success-screen'];
        
        function showScreen(screenIndex) {
            screens.forEach((screen, index) => {
                const element = document.getElementById(screen);
                if (index === screenIndex) {
                    element.classList.add('active');
                    element.focus();
                } else {
                    element.classList.remove('active');
                }
            });
            currentScreen = screenIndex;
            
            // Announce screen change for screen readers
            announceForScreenReader(`Now on ${getScreenName(screenIndex)}`);
        }
        
        function getScreenName(index) {
            const names = ['Welcome', 'Authentication', 'Conversation', 'Success'];
            return names[index] || 'Unknown';
        }
        
        // Screen reader announcements
        function announceForScreenReader(message) {
            const announcement = document.getElementById('audio-instructions');
            if (announcement) {
                announcement.textContent = message;
            }
            
            // Also use speech synthesis if available
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(message);
                utterance.rate = 0.8; // Slower for elderly users
                utterance.volume = 0.8;
                speechSynthesis.speak(utterance);
            }
        }
        
        // SCREEN 1: Welcome functions
        function startSetup() {
            announceForScreenReader('Starting setup. Moving to authentication.');
            showScreen(1);
        }
        
        // SCREEN 2: Authentication functions
        function addPin(digit) {
            if (pinCode.length < 4) {
                pinCode += digit;
                updatePinDisplay();
                announceForScreenReader(`Entered ${digit}. PIN has ${pinCode.length} digits.`);
                
                // Enable submit button when PIN is complete
                if (pinCode.length === 4) {
                    document.getElementById('submit-pin').disabled = false;
                    document.getElementById('submit-pin').focus();
                }
            }
        }
        
        function clearPin() {
            pinCode = '';
            updatePinDisplay();
            document.getElementById('submit-pin').disabled = true;
            announceForScreenReader('PIN cleared. Please enter your 4-digit code.');
        }
        
        function updatePinDisplay() {
            for (let i = 1; i <= 4; i++) {
                const dot = document.getElementById(`pin-${i}`);
                if (i <= pinCode.length) {
                    dot.classList.add('filled');
                    dot.textContent = '●';
                } else {
                    dot.classList.remove('filled');
                    dot.textContent = '';
                }
            }
        }
        
        function submitPin() {
            if (pinCode.length === 4) {
                // In real implementation, this would verify the PIN
                if (pinCode === '1234') { // Demo PIN
                    announceForScreenReader('PIN accepted! Moving to first conversation.');
                    showScreen(2);
                    initializeVoiceRecognition();
                } else {
                    announceForScreenReader('Incorrect PIN. Please try again or call Sarah for help.');
                    clearPin();
                }
            }
        }
        
        function forgotCode() {
            announceForScreenReader('Calling Sarah to help with your code.');
            callFamily();
        }
        
        function tryVoice() {
            announceForScreenReader('Switching to voice authentication.');
            // Would implement voice authentication here
            showScreen(2);
        }
        
        // SCREEN 3: Conversation functions
        function initializeVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    handleUserResponse(transcript);
                };
                
                recognition.onerror = function(event) {
                    announceForScreenReader('Sorry, I didn\'t catch that. Please try again.');
                    stopRecording();
                };
                
                recognition.onend = function() {
                    stopRecording();
                };
            }
        }
        
        function toggleRecording() {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }
        
        function startRecording() {
            if (recognition) {
                isRecording = true;
                const micButton = document.getElementById('mic-button');
                micButton.classList.add('recording');
                micButton.setAttribute('aria-label', 'Recording... Release to stop');
                
                updateAIStatus('listening', '🎤 I\'m listening...');
                activateAudioLevel();
                recognition.start();
                
                announceForScreenReader('Recording started. Speak now.');
            }
        }
        
        function stopRecording() {
            if (recognition && isRecording) {
                isRecording = false;
                const micButton = document.getElementById('mic-button');
                micButton.classList.remove('recording');
                micButton.setAttribute('aria-label', 'Press to speak your answer');
                
                updateAIStatus('thinking', '🤔 Let me think about that...');
                deactivateAudioLevel();
                recognition.stop();
            }
        }
        
        function updateAIStatus(type, message) {
            const status = document.getElementById('ai-status');
            status.className = `status ${type}`;
            status.textContent = message;
        }
        
        function activateAudioLevel() {
            const bars = document.querySelectorAll('.audio-bar');
            bars.forEach((bar, index) => {
                setTimeout(() => {
                    bar.classList.add('active');
                }, index * 100);
            });
        }
        
        function deactivateAudioLevel() {
            const bars = document.querySelectorAll('.audio-bar');
            bars.forEach(bar => {
                bar.classList.remove('active');
            });
        }
        
        function handleUserResponse(transcript) {
            // Add user message to conversation
            addMessageToConversation('user', transcript);
            
            // Simulate AI response based on conversation step
            setTimeout(() => {
                let aiResponse = generateAIResponse(currentConversationStep, transcript);
                addMessageToConversation('ai', aiResponse);
                
                currentConversationStep++;
                
                if (currentConversationStep >= 3) {
                    // Move to success screen after 3 questions
                    setTimeout(() => {
                        showScreen(3);
                    }, 2000);
                } else {
                    updateProgress();
                }
            }, 1500);
        }
        
        function addMessageToConversation(sender, message) {
            const conversation = document.getElementById('conversation-display');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            if (sender === 'ai') {
                messageDiv.innerHTML = `<strong>HomeBridge:</strong> ${message}`;
                updateAIStatus('speaking', '🗣️ HomeBridge is speaking...');
            } else {
                messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
            }
            
            conversation.appendChild(messageDiv);
            messageDiv.scrollIntoView({ behavior: 'smooth' });
            
            // Speak AI responses
            if (sender === 'ai') {
                speakMessage(message);
            }
        }
        
        function generateAIResponse(step, userInput) {
            const responses = [
                "That's wonderful to hear! Now, have you taken your morning medications today?",
                "Good! And how did you sleep last night? Any trouble falling asleep or staying asleep?",
                "Thank you for sharing that with me. You're doing great! Sarah will be happy to know you're doing well."
            ];
            return responses[step] || "Thank you for talking with me today!";
        }
        
        function updateProgress() {
            const progress = document.querySelector('.progress');
            progress.textContent = `Question ${currentConversationStep + 1} of 3 - Almost done!`;
        }
        
        function speakMessage(message) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(message);
                utterance.rate = 0.8;
                utterance.volume = 0.9;
                speechSynthesis.speak(utterance);
            }
        }
        
        function tryAgain() {
            announceForScreenReader('Let\'s try that again. Press the microphone button and speak clearly.');
        }
        
        function needHelp() {
            announceForScreenReader('Calling Sarah for help with the conversation.');
            callFamily();
        }
        
        // SCREEN 4: Success functions
        function practiceAgain() {
            currentConversationStep = 0;
            document.getElementById('conversation-display').innerHTML = `
                <div class="message ai">
                    <strong>HomeBridge:</strong> Hello Margaret! Let's practice again. How are you feeling today?
                </div>
            `;
            showScreen(2);
            announceForScreenReader('Starting practice conversation again.');
        }
        
        function finishSetup() {
            announceForScreenReader('Setup complete! HomeBridge will call you tomorrow at 9 AM. Thank you!');
            // In real implementation, this would save settings and close the setup
            alert('Setup complete! HomeBridge will call you tomorrow at 9:00 AM.');
        }
        
        // Family contact functions
        function callFamily() {
            announceForScreenReader(`Calling ${familyInfo.name} at ${familyInfo.phone}`);
            if (confirm(`Call ${familyInfo.name} at ${familyInfo.phone}?`)) {
                window.location.href = `tel:${familyInfo.phone}`;
            }
        }
        
        function emergencyCall() {
            announceForScreenReader('Emergency call to family member');
            window.location.href = `tel:${familyInfo.phone}`;
        }
        
        // Keyboard navigation support
        document.addEventListener('keydown', function(event) {
            // Space bar for main actions
            if (event.code === 'Space' && event.target.classList.contains('primary-button')) {
                event.preventDefault();
                event.target.click();
            }
            
            // Enter for voice recording
            if (event.code === 'Enter' && currentScreen === 2) {
                event.preventDefault();
                toggleRecording();
            }
            
            // Escape for emergency call
            if (event.code === 'Escape') {
                event.preventDefault();
                emergencyCall();
            }
        });
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            announceForScreenReader('Welcome to HomeBridge! Press the Start Talking button to begin.');
            
            // Set focus to main button
            const startButton = document.querySelector('.primary-button');
            if (startButton) {
                startButton.focus();
            }
        });
        
        // Prevent accidental zoom on mobile
        document.addEventListener('gesturestart', function(event) {
            event.preventDefault();
        });
        
        // Simple error handling for elderly users
        window.addEventListener('error', function(event) {
            announceForScreenReader('Something went wrong. Please call Sarah for help.');
            console.error('Error:', event.error);
        });
        
        // Battery level warning for mobile devices
        if ('getBattery' in navigator) {
            navigator.getBattery().then(function(battery) {
                if (battery.level < 0.2) {
                    announceForScreenReader('Your device battery is low. Please charge it soon.');
                }
            });
        }
    </script>
</body>
</html>